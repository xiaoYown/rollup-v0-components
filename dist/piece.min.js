/*!
 * Piece v0.0.0 (date: 2018-5-7 18:20)
 * (c) 2018 xiaoYown
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Piece=t()}(this,function(){"use strict";var e=[{el:"div",bindEL:"el",className:"xy__page",childrens:[{el:"div",bindEL:"elTotal",className:"xy__page-total",html:"\u5171 0 \u9875"},{el:"div",className:"xy__page-text",html:"\u6bcf\u9875"},{el:"div",bindEL:"elSize",className:"xy__page-size",childrens:[{el:"button",bindEL:"elSizeBtn",html:10},{el:"ul",bindEL:"elSizeCh",className:"xy__page-size_list",childrens:[{el:"li",html:10},{el:"li",html:15},{el:"li",html:20},{el:"li",html:30}]}]},{el:"div",className:"xy__page-text",html:"\u6761"},{el:"div",bindEL:"elLink",className:"xy__page-link",childrens:[{el:"div",bindEL:"elFirst",className:"xy__page-link_btn",childrens:[{el:"span",html:"\xab"}]},{el:"div",bindEL:"elPre",className:"xy__page-link_btn",childrens:[{el:"span",html:"\u2039"}]},{el:"div",bindEL:"elIndex",className:"xy__page-link_btn",childrens:[{el:"span",html:"0"}]},{el:"div",bindEL:"elNext",className:"xy__page-link_btn",childrens:[{el:"span",html:"\u203a"}]},{el:"div",bindEL:"elLast",className:"xy__page-link_btn",childrens:[{el:"span",html:"\xbb"}]}]},{el:"div",className:"xy__page-go",childrens:[{el:"input",bindEL:"elGoForm",className:"xy__page-go_form",attrs:{type:"text"}},{el:"span",bindEL:"elGoBtn",className:"xy__page-go_btn",html:"GO"}]}]}];var t=function(e){"string"==typeof e.wrap?this.wrap=document.getElementById(e.wrap):this.wrap=e.wrap,this.index=e.index,this.pageSize=e.pageSize,this.total=e.total,this.cb=e.cb,this.create()};return t.prototype.create=function(){this.calTotal(),function e(t,i){for(var s=[],n=null,l=[],h=0,a=i.length;h<a;h++){if(n=document.createElement(i[h].el),i[h].className&&(n.className=i[h].className),i[h].attrs)for(var o in i[h].attrs)n.setAttribute(o,i[h].attrs[o]);if(i[h].childrens)for(var r=0,d=(l=e(t,i[h].childrens)).length;r<d;r++)n.appendChild(l[r]);else i[h].html&&(n.innerHTML=i[h].html);i[h].bindEL&&(t[i[h].bindEL]?(t[i[h].bindEL].constructor===Array||(t[i[h].bindEL]=[t[i[h].bindEL]]),t[i[h].bindEL].push(n)):t[i[h].bindEL]=n),s.push(n)}return s}(this,e)},t.prototype.init=function(){this.wrap.appendChild(this.el),this.bindEvent(),this.updateView()},t.prototype.bindEvent=function(){this.elLink.addEventListener("selectstart",this.prevent.bind(this)),this.elFirst.addEventListener("click",this.linkFirst.bind(this)),this.elPre.addEventListener("click",this.linkPre.bind(this)),this.elNext.addEventListener("click",this.linkNext.bind(this)),this.elLast.addEventListener("click",this.linkLast.bind(this)),this.elSizeBtn.addEventListener("click",this.sizeChooseShow.bind(this)),this.elSizeCh.addEventListener("click",this.sizeChoose.bind(this)),this.elGoBtn.addEventListener("click",this.goPage.bind(this)),this.elGoForm.addEventListener("keydown",this.keydown.bind(this))},t.prototype.destroy=function(){for(var e in this.elLink.removeEventListener("selectstart",this.prevent.bind(this)),this.elFirst.removeEventListener("click",this.linkFirst.bind(this)),this.elPre.removeEventListener("click",this.linkPre.bind(this)),this.elNext.removeEventListener("click",this.linkNext.bind(this)),this.elLast.removeEventListener("click",this.linkLast.bind(this)),this.elSizeBtn.removeEventListener("click",this.sizeChooseShow.bind(this)),this.elSizeCh.removeEventListener("click",this.sizeChoose.bind(this)),this.elGoBtn.removeEventListener("click",this.goPage.bind(this)),this.elGoForm.removeEventListener("keydown",this.keydown.bind(this)),this.wrap.removeChild(this.el),this)this[e]=null},t.prototype.prevent=function(e){e.preventDefault()},t.prototype.calTotal=function(){this.pages=this.total%this.pageSize==0?this.total/this.pageSize:Math.floor(this.total/this.pageSize)+1},t.prototype.setLinkClass=function(e,t){for(var i="",s=0,n=e.length;s<n;s++)i=e[s].className.replace(/\sdisable/,""),e[s].className=t?i+" disable":i},t.prototype.updateView=function(){this.elTotal.innerHTML="\u5171 "+this.pages+" \u9875",this.elSizeBtn.innerHTML=this.pageSize,this.setLinkClass([this.elFirst,this.elPre],1===this.index),this.setLinkClass([this.elNext,this.elLast],this.index>=this.pages),this.elIndex.innerHTML=this.index},t.prototype.setView=function(){this.link(),this.updateView()},t.prototype.updateData=function(e){for(var t in e)this[t]=e[t];this.setView()},t.prototype.linkFirst=function(){1<this.index&&(this.index=1,this.setView())},t.prototype.linkPre=function(){1<this.index&&(this.index-=1,this.setView())},t.prototype.linkNext=function(){this.index<this.pages&&(this.index+=1,this.setView())},t.prototype.linkLast=function(){this.index<this.pages&&(this.index=this.pages,this.setView())},t.prototype.link=function(){this.cb({index:this.index,pageSize:this.pageSize,total:this.total})},t.prototype.sizeChooseShow=function(){var e=this.elSize.className;/choosing/.test(e)?this.elSize.className=e.replace(/\schoosing/,""):this.elSize.className+=" choosing"},t.prototype.sizeChoose=function(e){var t=parseInt(e.target.innerHTML.replace(/[^\d]+/g,""));this.pageSize!==t&&(this.pageSize=t,this.index=1,this.calTotal(),this.setView(),this.sizeChooseShow())},t.prototype.pageFilter=function(){var e,t=this.elGoForm.value,i=0;return/[^\d]+/.test(t)&&(t=t.replace(/[^\d]+/g,"")),t?(e=0===(i=parseInt(t))?1:i>this.pages?this.pages:i,this.elGoForm.value=e):(this.elGoForm.value="",null)},t.prototype.keydown=function(e){13===e.keyCode&&this.goPage()},t.prototype.goPage=function(){var e=this.pageFilter();e&&e!==this.index&&(this.index=e,this.setView())},{name:"piece",Pages:function(e){return new t(e)}}});